<?xml version="1.0" encoding="UTF-8"?>
<project name="code.google.com" default="all" basedir="./../">
    <property name="rebecca" location="${basedir}/rebecca/" />
    <property name="antibodydb" location="${basedir}/antibodydb/" />

    <property name="yui-compressor" location="${basedir}/build/yuicompressor-2.4.2.jar" />

    <target name="all">
        <antcall target="rebecca" />
        <antcall target="antibodydb" />
    </target>

    <target name="rebecca">
        <!-- css files -->
        <concat destfile="${rebecca}/public/css/Application.css" eol="lf" fixlastline="yes">
           <filelist dir="${rebecca}/public/css/src/" files="Application.css,
                                                             Ext.ux.FormUploadField.css,
                                                             Icons.css" />
        </concat>

        <!-- js base files -->
        <concat destfile="${rebecca}/public/js/Application.base.js" eol="lf" fixlastline="yes">
            <filelist dir="${rebecca}/public/js/src/" files="Ext.ux.form.FileUploadField.js,
                                                             Ext.ux.form.SearchField.js,
                                                             Ext.ux.form.SelectBox.js,
                                                             Ext.ux.grid.BufferView.js,
                                                             Application.util.js,
                                                             Application.js,
                                                             Application.Navigation.js,
                                                             Application.Panel.js,
                                                             Application.Viewport.js" />
        </concat>

        <!-- js guest files -->
        <concat destfile="${rebecca}/public/js/Application.guest.js" eol="lf" fixlastline="yes">
            <filelist dir="${rebecca}/public/js/src/guest/" files="Application.guest.Login.js,
                                                                   navigation.js" />
        </concat>

        <!-- js member files -->
        <concat destfile="${rebecca}/public/js/Application.member.js" eol="lf" fixlastline="yes">
            <filelist dir="${rebecca}/public/js/src/member/" files="Application.member.Stundenplan.js,
                                                                    Application.member.Vokabeln.js,
                                                                    navigation.js" />
        </concat>

        <!-- js admin files -->
        <concat destfile="${rebecca}/public/js/Application.admin.js" eol="lf" fixlastline="yes">
            <filelist dir="${rebecca}/public/js/src/member/" files="Application.member.Stundenplan.js,
                                                                    Application.member.Vokabeln.js" />
            <filelist dir="${rebecca}/public/js/src/admin/" files="Application.admin.User.js,
                                                                   navigation.js" />
        </concat>

        <antcall target="rebecca.min" />
    </target>

    <target name="rebecca.min">
        <!-- minify css -->
        <apply executable="java" parallel="false" failonerror="true">
            <fileset dir="${rebecca}/public/css/" includes="*.css" excludes="*-min*, ext*" />
            <arg line="-jar" />
            <arg path="${yui-compressor}" />
            <arg value="--charset" />
            <arg value="UTF-8" />
            <srcfile />
            <arg line="-o" />
            <mapper type="glob" from="*.css" to="${rebecca}/public/css/*-min.css" />
            <targetfile />
        </apply>

        <!-- minify js -->
        <apply executable="java" parallel="false" failonerror="true">
            <fileset dir="${rebecca}/public/js/" includes="*.js" excludes="*-min*, ext*" />
            <arg line="-jar" />
            <arg path="${yui-compressor}" />
            <arg value="--charset" />
            <arg value="UTF-8" />
            <srcfile />
            <arg line="-o" />
            <mapper type="glob" from="*.js" to="${rebecca}/public/js/*-min.js" />
            <targetfile />
        </apply>
    </target>

    <target name="antibodydb">
        <!-- css files -->
        <concat destfile="${antibodydb}/public/css/Antibodydb.css" eol="lf" fixlastline="yes">
           <filelist dir="${antibodydb}/public/css/src/" files="Antibodydb.css,
                                                                Icons.css" />
        </concat>

        <!-- js files -->
        <concat destfile="${antibodydb}/public/js/Antibodydb.js" eol="lf" fixlastline="yes">
            <filelist dir="${antibodydb}/public/js/src/" files="Antibodydb.js,

                                                                util/Antibodydb.util.js,
                                                                util/Ext.ux.form.SelectBox.js,
                                                                util/Ext.ux.form.FileUploadField.js,
                                                                util/Ext.ux.form.SearchField.js,
                                                                util/Ext.ux.grid.BufferView.js,
                                                                util/Antibodydb.FormPanel.js,
                                                                util/Antibodydb.EditorGridPanel.js,

                                                                forms/Antibodydb.forms.Antibody.js,
                                                                forms/Antibodydb.forms.Targetprotein.js,
                                                                forms/Antibodydb.forms.Incubationprotocol.js,

                                                                tables/Antibodydb.tables.Targetprotein.js,
                                                                tables/Antibodydb.tables.Incubationprotocol.js,
                                                                tables/Antibodydb.tables.Antibody.js,

                                                                user/Antibodydb.user.Password.js,

                                                                Antibodydb.Navigation.js,
                                                                Antibodydb.Panel.js,
                                                                Antibodydb.Viewport.js,

                                                                Antibodydb.init.js" />
        </concat>

        <!-- js login files -->
        <concat destfile="${antibodydb}/public/js/Antibodydb.login.js" eol="lf" fixlastline="yes">
            <filelist dir="${antibodydb}/public/js/src/" files="login/Antibodydb.login.js" />
        </concat>
        <antcall target="antibodydb.min" />
    </target>

    <target name="antibodydb.min">
        <!-- minify css -->
        <apply executable="java" parallel="false" failonerror="true">
            <fileset dir="${antibodydb}/public/css/" includes="*.css" excludes="*-min*, ext*" />
            <arg line="-jar" />
            <arg path="${yui-compressor}" />
            <arg value="--charset" />
            <arg value="UTF-8" />
            <srcfile />
            <arg line="-o" />
            <mapper type="glob" from="*.css" to="${antibodydb}/public/css/*-min.css" />
            <targetfile />
        </apply>

        <!-- minify js -->
        <apply executable="java" parallel="false" failonerror="true">
            <fileset dir="${antibodydb}/public/js/" includes="*.js" excludes="*-min*, ext*" />
            <arg line="-jar" />
            <arg path="${yui-compressor}" />
            <arg value="--charset" />
            <arg value="UTF-8" />
            <srcfile />
            <arg line="-o" />
            <mapper type="glob" from="*.js" to="${antibodydb}/public/js/*-min.js" />
            <targetfile />
        </apply>
    </target>

</project>